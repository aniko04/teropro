{% extends 'base.html' %}{% load static %} {% load tags %}
{% block content %}

<!-- Page Header -->
<section class="page-header">
    <div class="container">
        <div class="page-header-content">
            <h1>Barcha Mahsulotlar</h1>
            <p>Eng yangi va sifatli kiyimlarimizni kashf eting</p>
            <nav class="breadcrumb">
                <a href="{% url 'home' %}">Bosh sahifa</a>
                <span>/</span>
                <span>Mahsulotlar</span>
            </nav>
        </div>
    </div>
</section>

<!-- Filter Section -->
<section>
    <section class="filter-section">
        <div class="container">
            <div class="filters">
                <form method="get" action="{% url 'product' %}">
                    <div class="filter-group">
                        <label>Kategoriya:</label>
                        <select name="category" id="categoryFilter" onchange="this.form.submit()">
                            <option value="">Barchasi</option>
                            {% for c in categories %}
                            <option value="{{ c.id }}" {% if selected_category and selected_category.id == c.id %}selected{% endif %}>
                                {{ c.name }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="filter-group">
                        <label>Narx oralig'i:</label>
                        <select name="price" id="priceFilter" onchange="this.form.submit()">
                            <option value="">Barchasi</option>
                            <option value="0-100" {% if selected_price == "0-100" %}selected{% endif %}>$0 - $100</option>
                            <option value="100-300" {% if selected_price == "100-300" %}selected{% endif %}>$100 - $300
                            </option>
                            <option value="300-500" {% if selected_price == "300-500" %}selected{% endif %}>$300 - $500
                            </option>
                            <option value="500+" {% if selected_price == "500+" %}selected{% endif %}>$500+</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <label>Saralash:</label>
                        <select name="sort" id="sortFilter" onchange="this.form.submit()">
                            <option value="">Standart</option>
                            <option value="price-low" {% if selected_sort == "price-low" %}selected{% endif %}>Narx:
                                Pastdan yuqoriga</option>
                            <option value="price-high" {% if selected_sort == "price-high" %}selected{% endif %}>Narx:
                                Yuqoridan pastga</option>
                            <option value="name" {% if selected_sort == "name" %}selected{% endif %}>Nomi bo'yicha
                            </option>
                            <option value="newest" {% if selected_sort == "newest" %}selected{% endif %}>Eng yangi
                            </option>
                        </select>
                    </div>
                </form>
            </div>
        </div>
    </section>


    <!-- Products Section -->
    <section class="products-page">
        <div class="container">
            <div class="products-grid" id="productsGrid">
                <!-- Product 1 -->
                {% for product in products %}
                <div class="product-card" data-category="women" data-price="259">
                    <div class="product-image">
                        <img src="{{ product.main_image.url }}" alt="{{ product.name }}" width="100%">
                        <div class="placeholder-product product1"></div>
                        <div class="product-badge">{{ product.status}}</div>
                        <div class="product-actions">
                            <a href="{% url 'like_product' product.id  %}?path={{ request.get_full_path|urlencode }}" class="action-btn">{% if user.is_authenticated and product|in_likes:request.user %} <i class="fas fa-heart"></i>{% else %} <i class="far fa-heart"></i> {% endif %} </a>
                            <a href="{% url 'product_details' product.id %}" class="action-btn"><i
                                    class="fas fa-eye"></i></a>
                            {% if user.is_authenticated and product|in_cart:request.user %}
                                <a href="{% url 'add_to_cart' product.id %}?path={{ request.get_full_path|urlencode }}" class="action-btn add-to-cart cart-active">
                                    <i class="fas fa-shopping-cart"></i>
                                </a>
                            {% else %}
                                <a href="{% url 'add_to_cart' product.id %}?path={{ request.get_full_path|urlencode }}" class="action-btn add-to-cart">
                                    <i class="fas fa-shopping-cart"></i>
                                </a>
                            {% endif %}
                        </div>
                    </div>
                    <div class="product-info">
                        <h4>{{ product.name }}</h4>
                        <p class="product-category">{{ product.category }}</p>
                        {% if user.is_authenticated and product|in_cart:request.user %}
                            <small class="cart-indicator">âœ“ Savatga tashlandi</small>
                        {% endif %}
                        <div class="product-rating">
                           {{ product|average_rating|star_rating_html|safe }}
                        <span class="rating-count">({{ product|reviews_count }} baho)</span>
                        </div>
                        <div class="product-price">
                            <span class="current-price">${{ product.current_price|intspace }}</span>
                            <span class="old-price">${{ product.old_price|intspace }}</span>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>

            <!-- Pagination -->
            <div class="pagination">
                {% if products.has_previous %}
                <a
                    href="?category={{ selected_category }}&price={{ selected_price }}&sort={{ selected_sort }}&page={{ products.previous_page_number }}">&laquo;</a>
                {% endif %}

                {% for num in products.paginator.page_range %}
                {% if products.number == num %}
                <span class="active">{{ num }}</span>
                {% else %}
                <a
                    href="?category={{ selected_category.id }}&price={{ selected_price }}&sort={{ selected_sort }}&page={{ num }}">{{num }}</a>
                {% endif %}
                {% endfor %}

                {% if products.has_next %}
                <a
                    href="?category={{ selected_category }}&price={{ selected_price }}&sort={{ selected_sort }}&page={{ products.next_page_number }}">&raquo;</a>
                {% endif %}
            </div>

        </div>
    </section>

    <!-- Footer -->
    {% endblock %}