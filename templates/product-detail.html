{% extends 'base.html' %}{% load static %} {% load tags %}
{% block content %}
    

    <!-- Breadcrumb -->
    <section class="breadcrumb-section">
        <div class="container">
            <nav class="breadcrumb">
                <a href="{% url 'home' %}">Bosh sahifa</a>
                <span>/</span>
                <a href="{% url 'product' %}">Mahsulotlar</a>
                <span>/</span>
                <span id="productName">{{ product.name }}</span>
                
            </nav>
        </div>
    </section>

    <!-- Product Detail -->
    <section class="product-detail">
        <div class="container">
            <div class="product-detail-content">
                <!-- Product Images -->
                <div class="product-images">
                    <div class="main-image">
                        <div class="image-placeholder main-product-img product1">
                            <img class="product-image" src="{{ product.main_image.url }}" alt="{{ product.name }}">
                        </div>
                        <div class="image-badges">
                            <span class="badge new">{{ product.status }}</span>
                        </div>
                    </div>
                    <div class="thumbnail-images">
                        {% for img in product.images.all %}
                        <div class="thumbnail active">
                            <div class="image-placeholder product1">
                                <img class="product-image" src="{{ img.image.url }}" alt="Thumbnail" width="100%">
                            </div>
                        </div>
                        {% endfor %}    
                    </div>
                </div>


                <!-- Product Info -->
                <div class="product-info">
                    <div>
                    <h1 class="product-title">{{ product.name }} </h1>
                    <a href="{% url 'like_product' product.id  %}?path={{ request.path }}" class="action-btn">{% if user.is_authenticated and product|in_likes:request.user %} <i class="fas fa-heart"></i>{% else %} <i class="far fa-heart"></i> {% endif %} </a>
                    </div>
                    <div class="product-rating">
                        <div class="stars">
                            {{ product.grade|star_rating_html|safe }}
                        </div>
                        <span class="rating-text">({{ product.grade }} baho)</span>
                        <a href="#reviews" class="reviews-link">Barcha baholarni ko'rish</a>
                    </div>

                    <!-- Product Statistics -->
                    <div class="product-stats">
                        <span class="likes-stats">
                            <i class="fas fa-heart"></i>
                            {{ product|product_likes_count }} kishi yoqtirdi
                        </span> 
                        <br>
                        <span class="cart-stats">
                            <i class="fas fa-shopping-cart"></i>
                            {{ product|product_cart_count }} kishi savat qildi
                        </span>
                    </div>

                    <div class="product-price">
                        <span class="current-price">${{ product.current_price }}</span>
                        <span class="old-price">${{ product.old_price }}</span>
                        <span class="discount">{{ discount }}%</span>
                    </div>

                    <div class="product-description">
                        <p>{{ product.description }}</p>
                    </div>

                    <!-- Product Options -->
                    <div class="product-options">
                        <div class="option-group">
                            <label>Rang:</label>
                            <div class="color-options">
                                {% for color in product.colors.all %}
                                <div class="color-option" data-color="{{ color.name }}"
                                    style="background: {{ color.code }};"></div>
                                {% endfor %}
                            </div>
                        </div>

                        <div class="option-group">
                            <label>O'lcham:</label>
                            <div class="size-options">
                                {% for size in product.sizes.all %}
                                <button class="size-option" data-size="{{ size.name }}">{{ size.name }}</button>
                                {% endfor %}
                            </div>
                            <a href="#" class="size-guide">O'lchamlar jadvali</a>
                        </div>

                        <div class="option-group">
                            <label>Miqdor:</label>
                            <div class="quantity-control">
                                <button class="qty-btn minus">-</button>
                                <input type="number" value="1" min="1" class="quantity-input">
                                <button class="qty-btn plus">+</button>
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="product-actions">
                        <a href="{% url 'add_to_cart' product.id %}?path={{ request.path }}" class="add-to-cart-btn">
                            <i class="fas fa-shopping-cart"></i>
                            Savatga Qo'shish
                        </a>
                        <button class="wishlist-btn">
                            <i class="far fa-heart"></i>
                        </button>
                        <button class="share-btn">
                            <i class="fas fa-share-alt"></i>
                        </button>
                    </div>

                    <!-- Product Features -->
                    <div class="product-features">
                        <div class="feature">
                            <i class="fas fa-truck"></i>
                            <span>Tez yetkazib berish</span>
                        </div>
                        <div class="feature">
                            <i class="fas fa-undo"></i>
                            <span>14 kun qaytarish</span>
                        </div>
                        <div class="feature">
                            <i class="fas fa-shield-alt"></i>
                            <span>{{ product.guarantee }}</span>
                        </div>
                        <div class="feature">
                            <i class="fas fa-award"></i>
                            <span>Premium sifat</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Product Details Tabs -->
    <section class="product-tabs">
        <div class="container">
            <div class="tabs-header">
                <button class="tab-btn active" data-tab="description">Tavsif</button>
                <button class="tab-btn" data-tab="specifications">Xususiyatlari</button>
                <button class="tab-btn" data-tab="reviews">Baholar</button>
                <button class="tab-btn" data-tab="shipping">Yetkazib berish</button>
            </div>

            <div class="tabs-content">
                <div class="tab-pane active" id="description">
                    {% if product.content %}
                        {{ product.content|safe }}
                    {% else %}
                        <p>{{ product.description }}</p>
                        <br>
                        <h4>Mahsulot haqida qo'shimcha ma'lumot:</h4>
                        <p>Bu mahsulot yuqori sifatli materiallardan tayyorlangan bo'lib, uzoq muddat xizmat qiladi.</p>
                        <ul>
                            <li>Sifatli materiallar ishlatilgan</li>
                            <li>Zamonaviy dizayn</li>
                            <li>Ishonchli brend</li>
                            <li>Kafolat beriladi</li>
                        </ul>
                    {% endif %}
                </div>

                <div class="tab-pane" id="specifications">
                    <h3>Texnik Xususiyatlari</h3>
                    <table class="specs-table">
                        <tr>
                            <td>Material</td>
                            <td>{{ product.materials }}</td>
                        </tr>
                        <tr>
                            <td>Rang</td>
                            <td>{{ product.colors.all|join:", " }}</td>
                        </tr>
                        <tr>
                            <td>O'lchamlar</td>
                            <td>{{ product.sizes.all|join:", " }}</td>
                        </tr>
                        <tr>
                            <td>Uzunlik</td>
                            <td>{{ product.lengths }} sm</td>
                        </tr>
                        
                        <tr>
                            <td>Ishlab chiqarilgan</td>
                            <td>{{ product.producer }}</td>
                        </tr>
                       
                        <tr>
                            <td>Kafolat</td>
                            <td>{{ product.guarantee }}</td>
                        </tr>
                    </table>
                </div>

                <div class="tab-pane" id="reviews">
                    <div class="reviews-section">
                        <!-- Baholar xulosasi -->
                        <div class="reviews-summary">
                            <div class="rating-overview">
                                <div class="overall-rating">
                                    <span class="rating-number">{{ average_rating }}</span>
                                    <div class="rating-stars">
                                        {{ average_rating|star_rating_html|safe }}
                                    </div>
                                    <span class="total-reviews">{{ total_reviews_count }} baho asosida</span>
                                </div>
                                <div class="rating-breakdown">
                                    <div class="rating-bar">
                                        <span>5 yulduz</span>
                                        <div class="bar">
                                            <div class="fill" style="width: {{ rating_percentages.5 }}%"></div>
                                        </div>
                                        <span>{{ rating_counts.5 }}</span>
                                    </div>
                                    <div class="rating-bar">
                                        <span>4 yulduz</span>
                                        <div class="bar">
                                            <div class="fill" style="width: {{ rating_percentages.4 }}%"></div>
                                        </div>
                                        <span>{{ rating_counts.4 }}</span>
                                    </div>
                                    <div class="rating-bar">
                                        <span>3 yulduz</span>
                                        <div class="bar">
                                            <div class="fill" style="width: {{ rating_percentages.3 }}%"></div>
                                        </div>
                                        <span>{{ rating_counts.3 }}</span>
                                    </div>
                                    <div class="rating-bar">
                                        <span>2 yulduz</span>
                                        <div class="bar">
                                            <div class="fill" style="width: {{ rating_percentages.2 }}%"></div>
                                        </div>
                                        <span>{{ rating_counts.2 }}</span>
                                    </div>
                                    <div class="rating-bar">
                                        <span>1 yulduz</span>
                                        <div class="bar">
                                            <div class="fill" style="width: {{ rating_percentages.1 }}%"></div>
                                        </div>
                                        <span>{{ rating_counts.1 }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Baholar ro'yxati -->
                        <div class="reviews-list">
                            {% if all_reviews %}
                                {% for review in all_reviews %}
                                    <div class="review-item">
                                        <div class="review-header">
                                            <div class="reviewer-info">
                                                <div class="reviewer-avatar">
                                                    {{ review.user.username|first|upper }}
                                                </div>
                                                <div class="reviewer-details">
                                                    <h4>{{ review.user.username }}</h4>
                                                    <span class="review-date">{{ review.createddate|date:"d F Y" }}</span>
                                                </div>
                                            </div>
                                            <div class="review-rating">
                                                {% if review.rate > 0 %}
                                                    {{ review.rate|star_rating_html|safe }}
                                                {% else %}
                                                    <span class="no-rating">Baho berilmagan</span>
                                                {% endif %}
                                            </div>
                                        </div>
                                        {% if review.comment %}
                                            <div class="review-content">
                                                <p>{{ review.comment }}</p>
                                            </div>
                                        {% endif %}
                                    </div>
                                {% endfor %}
                            {% else %}
                                <div class="no-reviews">
                                    <p>Hali baholar yo'q. Birinchi bo'lib baho bering!</p>
                                </div>
                            {% endif %}
                        </div>

                        {% if all_reviews.count > 5 %}
                            <button class="load-more-reviews">Ko'proq ko'rish</button>
                        {% endif %}

                        <!-- Rating berish formi -->
                        <div class="rating-form-section">
                            <h4>Mahsulotga bahoingizni bering</h4>
                            {% if user.is_authenticated %}
                                <form action="{% url 'rate_product' product.id %}" method="POST" class="rating-form">
                                    {% csrf_token %}
                                    <div class="rating-input">
                                        <label>Ratingingiz:</label>
                                        <div class="star-rating">
                                            {% for i in "54321" %}
                                                <input type="radio" name="rating" value="{{ i }}" id="star{{ i }}"
                                                       {% if product|user_rating:user == i|add:0 %}checked{% endif %}>
                                                <label for="star{{ i }}" class="star-label">
                                                    <i class="fas fa-star"></i>
                                                </label>
                                            {% endfor %}
                                        </div>
                                    </div>
                                    <div class="comment-input">
                                        <label for="comment">Fikr-mulohazangiz:</label>
                                        <textarea name="comment" id="comment" rows="3" placeholder="Mahsulot haqida fikringizni yozing...">{{ product|user_comment:user }}</textarea>
                                    </div>
                                    <button type="submit" class="submit-rating-btn">
                                        {% if product|user_rating:user > 0 %}
                                            Ratingni Yangilash
                                        {% else %}
                                            Rating Berish
                                        {% endif %}
                                    </button>
                                </form>
                            {% else %}
                                <p class="login-message">
                                    Rating berish uchun <a href="{% url 'login' %}">tizimga kiring</a>
                                </p>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <div class="tab-pane" id="shipping">
                    <h3>Yetkazib Berish Ma'lumotlari</h3>

                    <div class="shipping-options">
                        <div class="shipping-option">
                            <div class="shipping-icon">
                                <i class="fas fa-truck"></i>
                            </div>
                            <div class="shipping-details">
                                <h4>Standart Yetkazib Berish</h4>
                                <p>3-5 ish kuni • Bepul (50$ dan yuqori buyurtmalar uchun)</p>
                                <span class="shipping-price">$5</span>
                            </div>
                        </div>

                        <div class="shipping-option">
                            <div class="shipping-icon">
                                <i class="fas fa-shipping-fast"></i>
                            </div>
                            <div class="shipping-details">
                                <h4>Tez Yetkazib Berish</h4>
                                <p>1-2 ish kuni • Har qanday buyurtma uchun</p>
                                <span class="shipping-price">$15</span>
                            </div>
                        </div>

                        <div class="shipping-option">
                            <div class="shipping-icon">
                                <i class="fas fa-store"></i>
                            </div>
                            <div class="shipping-details">
                                <h4>Do'kondan Olish</h4>
                                <p>24 soat ichida tayyor • Bepul</p>
                                <span class="shipping-price">Bepul</span>
                            </div>
                        </div>
                    </div>

                    <div class="return-policy">
                        <h4>Qaytarish Shartlari</h4>
                        <ul>
                            <li>Mahsulotni 14 kun ichida qaytarishingiz mumkin</li>
                            <li>Mahsulot asl holatida bo'lishi kerak</li>
                            <li>Qaytarish uchun kvitansiya talab qilinadi</li>
                            <li>Qaytarish xarajatlari mijoz zimmasiga</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Related Products -->
    <section class="related-products">
        <div class="container">
            <div class="section-header">
                <h2>O'xshash Mahsulotlar</h2>
                <p>Sizga yoqishi mumkin bo'lgan boshqa mahsulotlar</p>
            </div>

            <div class="products-grid">
                <div class="product-card">
                    <div class="product-image">
                        <div class="placeholder-product product2"></div>
                        <div class="product-actions">
                            <button class="action-btn wishlist-btn"><i class="far fa-heart"></i></button>
                            <a href="product-detail.html?id=2" class="action-btn"><i class="fas fa-eye"></i></a>
                            <button class="action-btn add-to-cart" data-id="2"><i
                                    class="fas fa-shopping-cart"></i></button>
                        </div>
                    </div>
                    <div class="product-info">
                        <h4>Classic Suit</h4>
                        <div class="product-rating">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                        </div>
                        <div class="product-price">
                            <span class="current-price">$499</span>
                        </div>
                    </div>
                </div>

                <div class="product-card">
                    <div class="product-image">
                        <div class="placeholder-product product3"></div>
                        <div class="product-badge sale">Chegirma</div>
                        <div class="product-actions">
                            <button class="action-btn wishlist-btn"><i class="far fa-heart"></i></button>
                            <a href="product-detail.html?id=3" class="action-btn"><i class="fas fa-eye"></i></a>
                            <button class="action-btn add-to-cart" data-id="3"><i
                                    class="fas fa-shopping-cart"></i></button>
                        </div>
                    </div>
                    <div class="product-info">
                        <h4>Casual Wear</h4>
                        <div class="product-rating">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="far fa-star"></i>
                        </div>
                        <div class="product-price">
                            <span class="current-price">$149</span>
                            <span class="old-price">$199</span>
                        </div>
                    </div>
                </div>

                <div class="product-card">
                    <div class="product-image">
                        <div class="placeholder-product product4"></div>
                        <div class="product-actions">
                            <button class="action-btn wishlist-btn"><i class="far fa-heart"></i></button>
                            <a href="product-detail.html?id=4" class="action-btn"><i class="fas fa-eye"></i></a>
                            <button class="action-btn add-to-cart" data-id="4"><i
                                    class="fas fa-shopping-cart"></i></button>
                        </div>
                    </div>
                    <div class="product-info">
                        <h4>Designer Bag</h4>
                        <div class="product-rating">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                        </div>
                        <div class="product-price">
                            <span class="current-price">$89</span>
                        </div>
                    </div>
                </div>

                <div class="product-card">
                    <div class="product-image">
                        <div class="placeholder-product product5"></div>
                        <div class="product-actions">
                            <button class="action-btn wishlist-btn"><i class="far fa-heart"></i></button>
                            <a href="product-detail.html?id=5" class="action-btn"><i class="fas fa-eye"></i></a>
                            <button class="action-btn add-to-cart" data-id="5"><i
                                    class="fas fa-shopping-cart"></i></button>
                        </div>
                    </div>
                    <div class="product-info">
                        <h4>Sport Shoes</h4>
                        <div class="product-rating">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="far fa-star"></i>
                        </div>
                        <div class="product-price">
                            <span class="current-price">$199</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- External JavaScript for Product Functionality -->
    <script src="{% static 'js/product-tabs.js' %}"></script>
 {% endblock %}  